<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ServPorTrabajador" language="groovy" pageWidth="900" pageHeight="595" orientation="Landscape" columnWidth="860" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="421befa0-9782-4fcf-8e2c-6763a19fc477">
	<property name="ireport.zoom" value="0.8264462809917371"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="254"/>
	<style name="Title" forecolor="#FFFFFF" fontName="Times New Roman" fontSize="50" isBold="false" pdfFontName="Times-Bold"/>
	<style name="SubTitle" forecolor="#666666" fontName="Times New Roman" fontSize="18" isBold="false" pdfFontName="Times-Roman"/>
	<style name="Column header" forecolor="#666666" fontName="Times New Roman" fontSize="14" isBold="true" pdfFontName="Times-Roman"/>
	<style name="Detail" mode="Transparent" fontName="Times New Roman" pdfFontName="Times-Roman"/>
	<style name="Row" mode="Transparent" fontName="Times New Roman" pdfFontName="Times-Roman">
		<conditionalStyle>
			<conditionExpression><![CDATA[$V{REPORT_COUNT}%2 == 0]]></conditionExpression>
			<style mode="Opaque" backcolor="#F0EFEF"/>
		</conditionalStyle>
	</style>
	<subDataset name="PieChartDataset" uuid="8f77ca9f-2e94-44b0-90c6-e21e7c7d8be4"/>
	<subDataset name="top3MecanicosRentab" uuid="dfaf76db-eed7-4966-91cc-33ad6251513e">
		<parameter name="fecha_inicio" class="java.util.Date"/>
		<parameter name="fecha_fin" class="java.util.Date"/>
		<queryString>
			<![CDATA[SELECT
    u.nombres || ' ' || u.apellidos AS mecanico,
    SUM(ds.precio) AS total_generado
FROM DETALLE_SERVICIO ds
JOIN ORDEN o ON ds.orden_id = o.orden_id
JOIN USUARIO u ON o.usuario_id = u.usuario_id
WHERE o.fecha_inicio BETWEEN $P{fecha_inicio} AND $P{fecha_fin}
GROUP BY mecanico
ORDER BY total_generado DESC
LIMIT 3;]]>
		</queryString>
		<field name="mecanico" class="java.lang.String"/>
		<field name="total_generado" class="java.math.BigDecimal"/>
	</subDataset>
	<parameter name="fecha_inicio" class="java.util.Date"/>
	<parameter name="fecha_fin" class="java.util.Date"/>
        <parameter name="fecha_inicio_str" class="java.lang.String"/>
        <parameter name="fecha_fin_str" class="java.lang.String"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false"/>
        <parameter name="REPORT_DIR" class="java.lang.String" isForPrompting="false"/>
        <parameter name="usuario" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT
    u.nombres || ' ' || u.apellidos AS mecanico,
    u.dni,
    COUNT(*) AS cantidad_servicios,
    SUM(ds.precio) AS total_generado
FROM DETALLE_SERVICIO ds
JOIN ORDEN o ON ds.orden_id = o.orden_id
JOIN USUARIO u ON o.usuario_id = u.usuario_id
WHERE o.fecha_inicio BETWEEN $P{fecha_inicio} AND $P{fecha_fin}
GROUP BY mecanico, dni
ORDER BY total_generado DESC;]]>
	</queryString>
	<field name="mecanico" class="java.lang.String"/>
	<field name="dni" class="java.lang.String"/>
	<field name="cantidad_servicios" class="java.lang.Long"/>
	<field name="total_generado" class="java.math.BigDecimal"/>
	<variable name="totalGeneral" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{total_generado}]]></variableExpression>
	</variable>
	<group name="Group 1">
		<groupExpression><![CDATA[(int)($V{REPORT_COUNT}/15)]]></groupExpression>
		<groupFooter>
			<band height="26">
				<textField>
					<reportElement x="472" y="6" width="118" height="20" uuid="2520bef3-da98-4dc6-b9b0-839239105fc0"/>
					<textElement>
						<font fontName="Times New Roman" size="12"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{totalGeneral}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="380" y="6" width="92" height="20" uuid="08ea3603-77d2-4dfc-8dd5-fab0b51948dc"/>
					<textElement>
						<font fontName="Times New Roman" size="12" isBold="true"/>
					</textElement>
					<text><![CDATA[Total general: ]]></text>
				</staticText>
			</band>
		</groupFooter>
	</group>
	<background>
		<band height="541" splitType="Stretch">
			<image>
				<reportElement x="28" y="99" width="308" height="178" uuid="5038e2b1-e870-4bb0-bb90-4d6fa0b1f208"/>
				<imageExpression><![CDATA[$P{REPORT_DIR} + "logoempresa.png"]]></imageExpression>
			</image>
			<pieChart>
				<chart>
					<reportElement x="28" y="295" width="325" height="188" uuid="6f5a6d31-8070-43d5-8e08-4f7a3cbfd9c3"/>
					<chartTitle position="Top">
						<font fontName="SansSerif" size="12" isBold="true" isItalic="true"/>
						<titleExpression><![CDATA["Top 3 de trabajadores que mas generaron"]]></titleExpression>
					</chartTitle>
					<chartSubtitle/>
					<chartLegend position="Bottom">
						<font size="11"/>
					</chartLegend>
				</chart>
				<pieDataset>
					<dataset>
						<datasetRun subDataset="top3MecanicosRentab" uuid="61d16651-573b-455a-8cf0-bf6b3bf74fa3">
							<datasetParameter name="fecha_inicio">
								<datasetParameterExpression><![CDATA[$P{fecha_inicio}]]></datasetParameterExpression>
							</datasetParameter>
							<datasetParameter name="fecha_fin">
								<datasetParameterExpression><![CDATA[$P{fecha_fin}]]></datasetParameterExpression>
							</datasetParameter>
						</datasetRun>
					</dataset>
					<keyExpression><![CDATA[$F{mecanico}]]></keyExpression>
					<valueExpression><![CDATA[$F{total_generado}]]></valueExpression>
					<labelExpression><![CDATA[String.valueOf($F{total_generado})]]></labelExpression>
				</pieDataset>
				<piePlot isShowLabels="true" isCircular="true">
					<plot/>
					<itemLabel/>
				</piePlot>
			</pieChart>
			<subreport>
				<reportElement x="412" y="295" width="428" height="207" uuid="070f6c17-8754-4944-9c4c-50a360048ff7"/>
				<subreportParameter name="fecha_inicio">
					<subreportParameterExpression><![CDATA[$P{fecha_inicio}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="fecha_fin">
					<subreportParameterExpression><![CDATA[$P{fecha_fin}]]></subreportParameterExpression>
				</subreportParameter>
                                <subreportParameter name="fecha_inicio_str">
                                    <subreportParameterExpression><![CDATA[$P{fecha_inicio_str}]]></subreportParameterExpression>
                                </subreportParameter>
                                <subreportParameter name="fecha_fin_str">
                                    <subreportParameterExpression><![CDATA[$P{fecha_fin_str}]]></subreportParameterExpression>
                                </subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "ServPorTrabajador_subreport1.jasper"]]></subreportExpression>
			</subreport>
                        <textField>
				<reportElement x="28" y="502" width="198" height="20" uuid="8ef8115a-abfe-4062-8ff4-46f66d5f07fd"/>
				<textElement>
					<font size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Realizado por: "+$P{usuario}]]></textFieldExpression>
			</textField>
		</band>
	</background>
	<title>
		<band height="161" splitType="Stretch">
			<staticText>
				<reportElement style="SubTitle" x="412" y="65" width="437" height="29" uuid="fbcbee22-6825-4944-a58e-f8b6e6776cae"/>
				<textElement textAlignment="Right">
					<font size="22" isBold="false"/>
				</textElement>
				<text><![CDATA[por trabajador]]></text>
			</staticText>
			<frame>
				<reportElement mode="Opaque" x="-20" y="0" width="880" height="65" forecolor="#006699" backcolor="#FF3333" uuid="bb59feab-a278-464e-a909-765e9bae31eb"/>
				<staticText>
					<reportElement style="Title" x="432" y="0" width="437" height="65" uuid="368841ce-a5b8-4bee-ada4-d12d7fcb3506"/>
					<textElement textAlignment="Right">
						<font size="54" isBold="false"/>
					</textElement>
					<text><![CDATA[Servicios realizados]]></text>
				</staticText>
			</frame>
			<staticText>
				<reportElement mode="Opaque" x="375" y="94" width="485" height="47" forecolor="#FFFFFF" backcolor="#FF3333" uuid="c3987cfa-8518-4ab6-91c1-28975b13b9e9"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="20" isBold="true"/>
				</textElement>
				<text><![CDATA[PRODUCTIVIDAD DE LOS TRABAJADORES]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Opaque" x="375" y="141" width="485" height="20" forecolor="#FFFFFF" backcolor="#FF0000" uuid="a2082666-3c31-4ccc-ac96-2f5b74989275"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="20" isBold="true"/>
				</textElement>
				<text><![CDATA[]]></text>
			</staticText>
			<textField>
				<reportElement x="375" y="141" width="485" height="20" forecolor="#FFFFFF" uuid="34344b7d-ce91-4732-8b22-35922c4322bf"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
                                <textFieldExpression><![CDATA[
                                "DEL (" + $P{fecha_inicio_str} + " - " + $P{fecha_fin_str} + ")"
                                ]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="34" splitType="Stretch">
			<staticText>
				<reportElement x="375" y="10" width="112" height="20" uuid="8265053b-5e5d-42ab-a3a2-669fba1d265f"/>
				<textElement textAlignment="Center">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[N° documento identidad]]></text>
			</staticText>
			<staticText>
				<reportElement x="487" y="10" width="151" height="20" uuid="453af5e5-4f64-4d82-abfe-dc47c9f1476c"/>
				<textElement textAlignment="Center">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Mecánico]]></text>
			</staticText>
			<staticText>
				<reportElement x="638" y="10" width="117" height="20" uuid="8156486f-cbc4-4ede-8922-db757952c372"/>
				<textElement textAlignment="Center">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[# Servicios]]></text>
			</staticText>
			<staticText>
				<reportElement x="755" y="10" width="105" height="20" uuid="f0c4711f-ee6a-4cd4-901a-a35b32e72029"/>
				<textElement textAlignment="Center">
					<font size="13" isBold="true"/>
				</textElement>
				<text><![CDATA[Total generado]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="21" splitType="Stretch">
			<textField>
				<reportElement x="375" y="0" width="112" height="20" uuid="53c427f9-9191-40e8-9e6e-dd86c98980b7"/>
				<textElement textAlignment="Center">
					<font size="13"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{dni}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="487" y="0" width="151" height="20" uuid="3e5de6f4-990b-466c-90f3-3a0f62349c9f"/>
				<textElement textAlignment="Center">
					<font size="13"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{mecanico}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="638" y="0" width="117" height="20" uuid="087d9279-1db6-41b3-b2ca-081bc36788e5"/>
				<textElement textAlignment="Center">
					<font size="13"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad_servicios}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="755" y="0" width="105" height="20" uuid="80ac5194-43d6-4f94-a6b6-d8450a45b2b3"/>
				<textElement textAlignment="Center">
					<font size="13"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{total_generado}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="380" y="20" width="480" height="1" uuid="47e8c563-973e-45f5-b1bc-6754745d92bd"/>
			</line>
		</band>
	</detail>
	<pageFooter>
		<band height="16" splitType="Stretch">
			<frame>
				<reportElement mode="Opaque" x="2" y="0" width="858" height="16" forecolor="#D0B48E" backcolor="#FF3333" uuid="a49d7168-8bfa-4c8b-aa77-109a42c919c9"/>
				<textField evaluationTime="Report">
					<reportElement style="Column header" x="804" y="0" width="40" height="16" forecolor="#FFFFFF" uuid="7f6c2355-9a48-4642-a389-abcd2d41a598"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial" size="12" isBold="false" pdfFontName="Helvetica"/>
					</textElement>
					<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement style="Column header" x="724" y="0" width="80" height="16" forecolor="#FFFFFF" uuid="caff3173-dece-47ff-8894-c51c694d2a6c"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font fontName="Arial" size="12" isBold="false" pdfFontName="Helvetica"/>
					</textElement>
					<textFieldExpression><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
				</textField>
				<textField pattern="EEEEE dd MMMMM yyyy">
					<reportElement style="Column header" x="53" y="0" width="197" height="16" forecolor="#FFFFFF" uuid="6823b363-4944-4c73-8b68-8812b21c4655"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Arial" size="12" isBold="false" pdfFontName="Helvetica"/>
					</textElement>
					<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>
